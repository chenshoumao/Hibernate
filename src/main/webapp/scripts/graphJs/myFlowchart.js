if(!(window.console&&console.log)){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(a){return this.slice(0,a.length)===a}}if(typeof mxClient==="undefined"){alert("Load graph engine fault.");throw"Load graph engine fault."}var initFlowchart;function MyFlowchart(){var h="1.2.0";var e,d,b=this;var C=mxConstants.EDGESTYLE_QINKL;var w;var u="#d8e6ff";var r;function B(){var H=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};return"bpmnid-"+H()+H()+"-"+H()+"-"+H()+"-"+H()+"-"+H()+H()+H()}function g(H){switch(H.type){case"start":return"start";case"end":return"end";case"lane":return"swimlane";case"gateway":switch(H.subtype){case"or":return"gatewayOr";case"and":return"gatewayAnd"}return"gateway";case"process":switch(H.subtype){case"sub":return"process_SUB_task";case"sys":return"process_SYS_task";case"link":return"process_LNK_task";case"HQ_seq":return"process_HQ_seq";case"HQ_par":return"process_HQ_par"}}}function F(M){if(typeof M==="string"){M=JSON.parse(M)}if(M.type&&M.type==="myFlowchar"){if(!s(M)){return}}else{M=o(M)}d.style.width=M.width+"px";d.style.height=M.height+"px";e.getModel().beginUpdate();try{mxEvent.disableContextMenu(d);var N=e.getDefaultParent();var K={};var H=function(P){var R=P.geometry;var Q=P.getParent();P.getGraph=function(){return K[this.id]};var S=e.insertVertex(Q?Q.getGraph():N,P.id,P,R.x,R.y,R.width,R.height,g(P));K[P.id]=S;if(P.children){for(var O=0;O<P.children.length;++O){H(P.children[O])}}};for(var J=0;J<M.rootnodes.length;++J){H(M.rootnodes[J])}var L=function(O){switch(O){case"topLeft":return[0.25,0];case"topCenter":return[0.5,0];case"topRight":return[0.75,0];case"rightTop":return[1,0.25];case"rightCenter":return[1,0.5];case"rightBottom":return[1,0.75];case"bottomLeft":return[0.25,1];case"bottomCenter":return[0.5,1];case"bottomRight":return[0.75,1];case"leftTop":return[0,0.25];case"leftCenter":return[0,0.5];case"leftBottom":return[0,0.75]}return[0,0.5]};var I=function(T){var V;var U=L(T.startPosition);V="exitX="+U[0]+";exitY="+U[1]+";";var U=L(T.endPosition);V+="entryX="+U[0]+";entryY="+U[1]+";";if(T.type==="default"){V+="strokeWidth=2;startArrow=dash;startSize=12;"}var W=N;if(T.start.getParent()&&T.end.getParent()&&T.start.getParent().getGraph()===T.end.getParent().getGraph()){W=T.end.getParent().getGraph()}T.getGraph=function(){return K[this.id]};var P=e.insertEdge(W,T.id,T,T.start.getGraph(),T.end.getGraph(),V);K[T.id]=P;if(T.label&&T.label.geometry){var R=T.label.geometry;P.geometry=new mxGeometry(R.x,R.y,R.width,R.height);P.geometry.relative=true}if(T.intermediatePoints){var Q=[];for(var S=0;S<T.intermediatePoints.length;++S){var O=T.intermediatePoints[S];if(O){Q[S]=new mxPoint(O.x,O.y)}}P.geometry.points=Q}};for(var J=0;J<M.links.length;++J){I(M.links[J])}}finally{e.getModel().endUpdate()}}function i(K){var J=K.element;if(typeof J==="string"){J=$("#"+K.element)}if(!J.length){return}r={node:null,toolbar:J};J.html("");var H=function(Q,M){if(!Q){return}var P=$("<a>"+Q.text+"</a>");if(Q["class"]){P.addClass(Q["class"])}if(Q.img){var O=$("<img/>");O.attr("src",Q.img);P.prepend(O)}if(Q.attr){for(var N in Q.attr){P.attr(N,Q.attr[N])}}P.click(function(R){$(".btn",J).removeClass("active");$(R.originalEvent.target).toggleClass("active");M();r.node.label={text:Q.text}});J.append(P)};var L={start:function(){r.node={type:"start",geometry:{width:40,height:40}}},end:function(){r.node={type:"end",geometry:{width:40,height:40}}},gateway:function(){r.node={type:"gateway",geometry:{width:40,height:40}}},gateway_or:function(){r.node={type:"gateway",subtype:"or",geometry:{width:40,height:40}}},gateway_and:function(){r.node={type:"gateway",subtype:"and",geometry:{width:40,height:40}}},process:function(){r.node={type:"process",geometry:{width:100,height:60}}},process_link:function(){r.node={type:"process",subtype:"link",geometry:{width:100,height:60}}},process_sub:function(){r.node={type:"process",subtype:"sub",geometry:{width:100,height:60}}},process_sys:function(){r.node={type:"process",subtype:"sys",geometry:{width:100,height:60}}},process_HQ_seq:function(){r.node={type:"process",subtype:"HQ_seq",geometry:{width:100,height:60}}},process_HQ_par:function(){r.node={type:"process",subtype:"HQ_par",geometry:{width:100,height:60}}},swimlane:function(){r.node={type:"lane",geometry:{width:$(d).width()-20,height:200}}}};for(var I in K.btns){H(K.btns[I],L[I])}}function x(){if(!initFlowchart){initFlowchart=true;mxConstants.SHADOWCOLOR="#e0e0e0";mxConstants.DEFAULT_FONTFAMILY="΢���ź�";mxConstants.DEFAULT_FONTSIZE=12;mxEdgeHandler.prototype.snapToTerminals=true;mxConstraintHandler.prototype.pointImage=new mxImage(mxBasePath+"/images/dot.gif",10,10);mxConnectionHandler.prototype.connectImage=new mxImage(mxBasePath+"/images/connector.gif",16,16);mxConnectionHandler.prototype.getIconPosition=function(W,P){var T=P.getCenterX();var Q=P.y+P.height-W.bounds.height/2;if(this.graph.isSwimlane(P.cell)){var R=this.graph.getView().scale;var Z=this.graph.getStartSize(P.cell);T=(Z.width!=0)?P.x+Z.width*R/2:T;Q=(Z.height!=0)?P.y+Z.height*R/2:Q;var S=mxUtils.toRadians(mxUtils.getValue(P.style,mxConstants.STYLE_ROTATION)||0);if(S!=0){var X=Math.cos(S);var V=Math.sin(S);var U=new mxPoint(P.getCenterX(),P.getCenterY());var Y=mxUtils.getRotatedPoint(new mxPoint(T,Q),X,V,U);T=Y.x;Q=Y.y}}return new mxPoint(T-W.bounds.width/2,Q-W.bounds.height/2)};function I(){}I.prototype=new mxLabel();I.prototype.constructor=I;I.prototype.paintVertexShape=function(W,Q,V,R,T){var P=R/2;var S=T/2;var U=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;W.begin();this.addPoints(W,[new mxPoint(Q+P,V),new mxPoint(Q+R,V+S),new mxPoint(Q+P,V+T),new mxPoint(Q,V+S)],this.isRounded,U,true);W.fillAndStroke();this.paintImage(W,Q,V,R,T)};mxCellRenderer.registerShape("ImageRhombus",I);mxMarker.addMarker("dash",function(Q,T,V,U,X,W,aa,P,Y,Z){var S=X*(aa+Y+1);var R=W*(aa+Y+1);return function(){Q.begin();Q.moveTo(U.x-S/2-R/2,U.y-R/2+S/2);Q.lineTo(U.x+R/2-3*S/2,U.y-3*R/2-S/2);Q.stroke()}});mxCell.prototype.getValue=function(){return this.value&&this.value.label?this.value.label.text:null};mxCell.prototype.setValue=function(P){if(!this.value){this.value={label:{text:P}}}else{if(!this.value.label){this.value.label={}}this.value.label.text=P}}}e=new mxGraph(d);e.setPortsEnabled(false);e.setAllowDanglingEdges(false);e.connectionHandler.isConnectableCell=function(P){return false};e.setHtmlLabels(true);var O=e.getStylesheet(),K;K=O.getDefaultEdgeStyle();K[mxConstants.STYLE_EDGE]=mxStyleRegistry.getValue(C);K[mxConstants.STYLE_ROUNDED]=true;mxConstants.RECTANGLE_ROUNDING_FACTOR=0.1;mxConstants.LINE_ARCSIZE=12;K[mxConstants.STYLE_STROKECOLOR]="#888";K[mxConstants.STYLE_SHADOW]=true;K[mxConstants.STYLE_FONTCOLOR]="green";K[mxConstants.STYLE_FONTSIZE]=14;K=O.getDefaultVertexStyle();K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_ROUNDED;K[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;K[mxConstants.STYLE_FILLCOLOR]=u;K[mxConstants.STYLE_GRADIENTCOLOR]="white";K[mxConstants.STYLE_GRADIENT_DIRECTION]=mxConstants.DIRECTION_NORTH;K[mxConstants.STYLE_PERIMETER_SPACING]=4;K[mxConstants.STYLE_ROUNDED]=true;K[mxConstants.STYLE_SHADOW]=true;K[mxConstants.STYLE_FONTCOLOR]="black";K[mxConstants.STYLE_WHITE_SPACE]="wrap";K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_LABEL;K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_LEFT;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_TOP;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/system.png";K[mxConstants.STYLE_IMAGE_WIDTH]=10;K[mxConstants.STYLE_IMAGE_HEIGHT]=10;O.putCellStyle("process_SYS_task",K);K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_LABEL;K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_RIGHT;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/plus.png";K[mxConstants.STYLE_IMAGE_WIDTH]=10;K[mxConstants.STYLE_IMAGE_HEIGHT]=10;K[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_LEFT;K[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_TOP;K[mxConstants.STYLE_SPACING_LEFT]=20;K[mxConstants.STYLE_LABEL_BORDERCOLOR]="#888";O.putCellStyle("process_SUB_task",K);K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_LABEL;K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_RIGHT;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/plus.png";K[mxConstants.STYLE_IMAGE_WIDTH]=10;K[mxConstants.STYLE_IMAGE_HEIGHT]=10;K[mxConstants.STYLE_STROKEWIDTH]=2;O.putCellStyle("process_LNK_task",K);K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_LABEL;K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_LEFT;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/sort.png";K[mxConstants.STYLE_IMAGE_WIDTH]=10;K[mxConstants.STYLE_IMAGE_HEIGHT]=10;O.putCellStyle("process_HQ_seq",K);K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_LABEL;K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_LEFT;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/sort-rating.png";K[mxConstants.STYLE_IMAGE_WIDTH]=10;K[mxConstants.STYLE_IMAGE_HEIGHT]=10;O.putCellStyle("process_HQ_par",K);K=mxUtils.clone(O.getDefaultVertexStyle());K[mxConstants.STYLE_SHAPE]="ImageRhombus";K[mxConstants.STYLE_PERIMETER]=mxPerimeter.RhombusPerimeter;K[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;K[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;K[mxConstants.STYLE_VERTICAL_LABEL_POSITION]=mxConstants.ALIGN_BOTTOM;K[mxConstants.STYLE_ROUNDED]=false;K[mxConstants.STYLE_WHITE_SPACE]="nowrap";K[mxConstants.STYLE_IMAGE_ALIGN]=mxConstants.ALIGN_CENTER;K[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;K[mxConstants.STYLE_IMAGE_WIDTH]=16;K[mxConstants.STYLE_IMAGE_HEIGHT]=16;K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/question-shield.png";O.putCellStyle("gateway",K);K=mxUtils.clone(K);K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/arrow-join.png";O.putCellStyle("gatewayOr",K);K=mxUtils.clone(K);K[mxConstants.STYLE_IMAGE]=mxBasePath+"/images/arrow-split.png";O.putCellStyle("gatewayAnd",K);K=[];K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_SWIMLANE;K[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;K[mxConstants.STYLE_FONTCOLOR]="#606060";K[mxConstants.STYLE_FILLCOLOR]="#E0E0DF";K[mxConstants.STYLE_GRADIENTCOLOR]="white";K[mxConstants.STYLE_STARTSIZE]=30;K[mxConstants.STYLE_ROUNDED]=false;K[mxConstants.STYLE_FONTSIZE]=14;K[mxConstants.STYLE_FONTSTYLE]=0;K[mxConstants.STYLE_HORIZONTAL]=false;K[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR]="#efefef";O.putCellStyle("swimlane",K);K=[];K[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_ELLIPSE;K[mxConstants.STYLE_PERIMETER]=mxPerimeter.EllipsePerimeter;K[mxConstants.STYLE_WHITE_SPACE]="nowrap";K[mxConstants.STYLE_FONTCOLOR]="gray";K[mxConstants.STYLE_FILLCOLOR]="#A0C88F";K[mxConstants.STYLE_GRADIENTCOLOR]="white";K[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;K[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;O.putCellStyle("start",K);K=mxUtils.clone(K);K[mxConstants.STYLE_FILLCOLOR]="#DACCBC";K[mxConstants.STYLE_STROKECOLOR]="#555";K[mxConstants.STYLE_STROKEWIDTH]=3;O.putCellStyle("end",K);var J=[new mxConnectionConstraint(new mxPoint(0,0.25),true,"leftTop"),new mxConnectionConstraint(new mxPoint(0,0.75),true,"leftBottom"),new mxConnectionConstraint(new mxPoint(1,0.25),true,"rightTop"),new mxConnectionConstraint(new mxPoint(1,0.75),true,"rightBottom"),new mxConnectionConstraint(new mxPoint(0.25,1),true,"bottomLeft"),new mxConnectionConstraint(new mxPoint(0.75,1),true,"bottomRight"),new mxConnectionConstraint(new mxPoint(0.25,0),true,"topLeft"),new mxConnectionConstraint(new mxPoint(0.75,0),true,"topRight")];var H=[new mxConnectionConstraint(new mxPoint(0,0.5),true,"leftCenter"),new mxConnectionConstraint(new mxPoint(1,0.5),true,"rightCenter"),new mxConnectionConstraint(new mxPoint(0.5,1),true,"bottomCenter"),new mxConnectionConstraint(new mxPoint(0.5,0),true,"topCenter")];w=H.concat(J);e.getAllConnectionConstraints=function(P){if(P!=null&&P.cell.isVertex()){var Q=P.cell.style;return Q&&(Q==="start"||Q==="end"||Q.startsWith("gateway"))?H:w}return null};var N=e.getConnectionPoint;e.getConnectionPoint=function(Q,R){if(R.id!=null&&Q!=null&&Q.shape!=null){var P=Q.shape.getPorts()[R.id];if(P!=null){R=new mxConnectionConstraint(new mxPoint(P.x,P.y),P.perimeter)}}return N.apply(this,arguments)};e.connectionHandler.createEdgeState=function(Q){var P=e.createEdge(null,null,null,null,null,"edgeStyle="+C);return new mxCellState(this.graph.view,P,this.graph.getCellStyle(P))};e.isCellConnectable=function(P){return P&&P.value&&P.style!=="swimlane"};e.isCellMovable=function(P){return P&&P.isVertex()&&P.value};e.getTooltipForCell=function(P){return P.value&&P.value.state?P.value.state.message:null};e.setTooltips(true);e.addListener(mxEvent.CLICK,function(S,R){var Q;if(!b.getSelectOnly()&&r&&r.node){e.getModel().beginUpdate();try{var T=R.properties.event;var U;if(r.node.type==="lane"){U=e.getDefaultParent()}else{if(!(r.node.type==="process"&&r.node.subtype==="sub")){U=e.getCellAt(T.layerX,T.layerY,null,true,false,function(W){return W.cell.style!=="process_SUB_task"})}if(!U){U=e.getSwimlaneAt(T.layerX,T.layerY);U=!U?e.getDefaultParent():U}}r.node.id=B();var P=T.offsetX,V=T.offsetY;if(U.geometry){P-=U.geometry.x;V-=U.geometry.y}Q=e.insertVertex(U,r.node.id,r.node,P,V,r.node.geometry.width,r.node.geometry.height,g(r.node))}finally{e.getModel().endUpdate()}$(".btn",r.toolbar).removeClass("active");r.node=null}else{b.currentSelected=null;Q=R.getProperty("cell")}if(Q&&Q.value&&Q.value.type){if(Q.value.type!=="start"&&Q.value.type!=="end"){b.currentSelected=j(Q.value);if(b.onSelected){b.onSelected.call(Q.value,b.currentSelected)}}}});e.setDropEnabled(true);e.setSplitEnabled(false);e.isValidDropTarget=function(U,Z,Y){var T=this.getModel();var S=false;var W=false;var P=false;var V=function(aa){var ab=T.getChildren(aa);if(ab){for(var ac=0;ac<ab.length;++ac){if(e.isSwimlane(ab[ac])){return true}}}return false};for(var R=0;R<Z.length;R++){var X=Z[R];var Q=e.isSwimlane(X);W=W||(Q&&V(X));S=S||Q;P=P||X.style==="process_SUB_task"}if(W){return false}if(S){return e.isSwimlane(U)&&!e.isSwimlane(T.getParent(U))}if(e.isSwimlane(U)){return true}if(!P&&U.style==="process_SUB_task"){return true}return false};e.model.getStyle=function(P){var Q=mxGraphModel.prototype.getStyle.apply(this,arguments);if(e.isCellCollapsed(P)){if(Q!=null){Q+=";"}else{Q=""}Q+="horizontal=1;align=left;spacingLeft=20;"}return Q};e.addListener(mxEvent.FOLD_CELLS,function(T,Q){var R=Q.getProperty("cells");for(var S=0;S<R.length;S++){var P=R[S];var U=e.model.getGeometry(P);if(e.isSwimlane(P)){if(U.alternateBounds!=null){U.width=U.alternateBounds.width}}else{if(P.isCollapsed()){U.width=100;U.height=60}}}});new mxSwimlaneManager(e);var L=new mxStackLayout(e,false);L.resizeParent=true;L.fill=true;L.isVertexIgnored=function(P){return !e.isSwimlane(P)};var M=new mxLayoutManager(e);M.getLayout=function(P){var Q=e.getModel();var S=Q.getParent(P);var R=function(T){return S!=null&&Q.getParent(S)===Q.getRoot()};if(!Q.isEdge(P)&&e.getModel().getChildCount(P)>0&&(S===Q.getRoot()||R(P))){L.fill=R(P);return L}return null};e.isCellFoldable=function(P,Q){return P.style==="process_SUB_task"};e.setGridEnabled(false)}if(!mxClient.isBrowserSupported()){mxUtils.error("��֧�ֵ��������",200,false);return}var m,q;if(arguments.length===2){d=arguments[0];m=arguments[1]}else{if(arguments.length===1){q=arguments[0];d=q.canvasDiv;m=q.modeldata;this.onSelected=q.onSelected}}if(!m&&!q){mxUtils.error("Flowchart��������",200,false);return}if(typeof d==="string"){d=document.getElementById(d)}if(!d){mxUtils.error("������flowchart�Ļ���div��",200,false);return}d.innerHTML="";d.style.backgroundImage="url('"+mxBasePath+"/images/grid.gif')";x();r=null;if(q&&q.toolbar){i(q.toolbar)}if(m){F(m)}this.onSelected;this.currentSelected;this.getCellById=function(I){var H=e.getModel().getCell(I);if(!H||!H.value){return}return j(H.value)};this.clear=function(){e.getSelectionModel().clear();this.currentSelected=null};this.updateCell=function(M,L){var H=e.getModel().getCell(M);if(!H||!H.value){return}if(!H.value.type||H.value.type==="start"||H.value.type==="end"){return}L=L||{};var K=L.state,I=L.statemessage;if(H.value.state){if(K==null){K=H.value.state.type}if(I==null){I=H.value.state.message}}if(K!=null){e.setCellStyles(mxConstants.STYLE_FILLCOLOR,u,[H]);e.removeCellOverlays(H);if(K==="running"){e.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#fbf849",[H])}else{if(K==="waiting"){e.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#fff2cc",[H])}else{if(K==="completed"){e.setCellStyles(mxConstants.STYLE_FILLCOLOR,"white",[H])}else{if(K==="error"){e.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#ffc4c4",[H]);e.addCellOverlay(H,J(e.warningImage,I))}}}}}function J(P,O){var N=new mxCellOverlay(P,O);N.cursor=null;return N}H.value.state={type:K,message:I};if(L.label){if(!H.value.label){H.value.label={}}H.value.label.text=L.label}return true};function A(I,J,K,H,L){this.locked=(I!=null)?I:false;this.createEdges=(J!=null)?J:true;this.editEdges=(K!=null)?K:true;this.editVertices=(H!=null)?H:true;this.cloneCells=(L!=null)?L:true}A.prototype.apply=function(H){H.setConnectable(this.createEdges);H.setCellsLocked(this.locked)};var n=null;var z=function(H){e.clearSelection();H.apply(e);e.setEnabled(true);e.setTooltips(true);e.refresh();n=H};z(new A());var f=e.isCellDisconnectable;e.isCellDisconnectable=function(H,I,J){return f.apply(this,arguments)&&n.editEdges};var l=e.isTerminalPointMovable;e.isTerminalPointMovable=function(H){return l.apply(this,arguments)&&n.editEdges};var G=e.isCellBendable;e.isCellBendable=function(H){return G.apply(this,arguments)&&n.editEdges};var y=e.isLabelMovable;e.isLabelMovable=function(H){return y.apply(this,arguments)&&n.editEdges};var a=e.isCellMovable;e.isCellMovable=function(H){return a.apply(this,arguments)&&n.editVertices};var t=e.isCellResizable;e.isCellResizable=function(H){return t.apply(this,arguments)&&n.editVertices};var k=e.isCellEditable;e.isCellEditable=function(H){return k.apply(this,arguments)&&(this.getModel().isVertex(H)&&n.editVertices)||(this.getModel().isEdge(H)&&n.editEdges)};var c=e.isCellDeletable;e.isCellDeletable=function(H){return c.apply(this,arguments)&&(this.getModel().isVertex(H)&&n.editVertices)||(this.getModel().isEdge(H)&&n.editEdges)};var E=e.isCellCloneable;e.isCellCloneable=function(H){return E.apply(this,arguments)&&n.cloneCells};var D=new mxRubberband(e);var p=new mxKeyHandler(e);p.bindKey(46,function(H){if(e.isEnabled()){e.removeCells()}});p.isEventIgnored=function(){return !this.graph.container||v(this.graph.container)||this.graph.isEditing()};function v(I){var H=window.getComputedStyle(I);return(H.display==="none")}this.destroy=function(){e.destroy();p.destroy()};this.setSelectOnly=function(H){if(H){z(new A(false,false,false,false,false));D.setEnabled(false);p.setEnabled(false)}else{z(new A());D.setEnabled(true);p.setEnabled(true)}};this.getSelectOnly=function(){return !D.isEnabled()};this.setEnabled=function(H){e.setEnabled(H)};this.getEnabled=function(){return e.getEnabled()};this.getVersion=function(){return h};this.exportModelData=function(){var H=e.getDefaultParent();if(!H){return null}var K=function(O,Q){var P;if(Q){P="exit"}else{P="entry"}var R=O.style.indexOf(P+"X=");if(R===-1){return}var M=parseFloat(O.style.substring(R+P.length+2));R=O.style.indexOf(P+"Y=");if(R===-1){return}var T=parseFloat(O.style.substring(R+P.length+2));for(var N=0;N<w.length;++N){var S=w[N];if(S.point.x===M&&S.point.y===T){return S.name}}};var J=[],I=[];var L=function(M){for(var Q=0;Q<M.getChildCount();++Q){var T=M.getChildAt(Q);var P=_.clone(T.value||{});var S=T.geometry;if(T.isEdge()){var O=null;if(P.label){P.label.geometry={x:S.x,y:S.y,width:S.width,height:S.height}}if(S.points){O=[];for(var N in T.geometry.points){var R=T.geometry.points[N];O[N]={x:R.x,y:R.y}}}delete P.intermediatePoints;if(O){P.intermediatePoints=O}P.start=T.getTerminal(true).id;P.startPosition=K(T,true);P.end=T.getTerminal(false).id;P.endPosition=K(T,false);P.id=T.id;I.push(P)}else{if(M.id!=="1"){P._parent=M.id}delete P.children;P.geometry={x:S.x,y:S.y,width:S.width,height:S.height};J.push(P)}L(T)}};L(H);return{version:"1.5",type:"myFlowchar",width:parseInt(d.style.width),height:parseInt(d.style.height),nodes:J,links:I}};this.exportBPMNString=function(I){function V(ao,an){var ap=function(ar,au,ax){var at="";if(ar instanceof Array){for(var av=0,ay=ar.length;av<ay;av++){at+=ax+ap(ar[av],au,ax+"\t")+"\n"}}else{if(typeof(ar)=="object"){var aw=false;at+=ax+"<"+au;for(var aq in ar){if(aq.charAt(0)=="@"){at+=" "+aq.substr(1)+'="'+ar[aq].toString()+'"'}else{aw=true}}at+=aw?">":"/>";if(aw){for(var aq in ar){if(aq=="#text"){at+=ar[aq]}else{if(aq=="#cdata"){at+="<![CDATA["+ar[aq]+"]]>"}else{if(aq.charAt(0)!="@"){at+=ap(ar[aq],aq,ax+"\t")}}}}at+=(at.charAt(at.length-1)=="\n"?ax:"")+"</"+au+">"}}else{at+=ax+"<"+au+">"+ar.toString()+"</"+au+">"}}return at},am="";for(var al in ao){am+=ap(ao[al],al,"")}return an?am.replace(/\t/g,an):am.replace(/\t|\n/g,"")}var L=this.exportModelData();var Q=function(ar,ap){var al={},aq=[];for(var an=0;an<ar.length;++an){var at=ar[an];al[at.id]=at;if(!at._parent){aq.push(at)}}for(var an=0;an<ar.length;++an){var at=ar[an];if(at._parent){var ao=al[at._parent];if(!ao.child){ao.child=[]}ao.child.push(at);at.parent=ao}}for(var an=0;an<ap.length;++an){var am=ap[an];var at=al[am.start];if(!at.outgoing){at.outgoing=[]}at.outgoing.push(am.id);at=al[am.end];if(!at.incoming){at.incoming=[]}at.incoming.push(am.id)}return aq};var ae=Q(L.nodes,L.links);var O=function(ap,aq,am,ar){var at={};if(am){for(var ao in am){var an=am[ao];at["@"+ao]=an}}if(ar){at["#text"]=ar}var al=ap[aq];if(!al){ap[aq]=at}else{if(al instanceof Array){al.push(at)}else{ap[aq]=[al,at]}}return at};function af(al){switch(al.type){case"start":return"bpmn:startEvent";case"end":return"bpmn:endEvent";case"lane":return"";case"gateway":switch(al.subtype){case"or":return"bpmn:parallelGateway";case"and":return"bpmn:inclusiveGateway"}return"bpmn:exclusiveGateway";case"process":switch(al.subtype){case"sub":return"bpmn:subProcess"}return"bpmn:userTask"}}var aa={};var H=O(aa,"bpmn:definitions",{id:B(),targetNamespace:I.targetNamespace,"xmi:version":"2.0","xmlns:xmi":"http://www.omg.org/XMI","xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","xmlns:di":"http://www.omg.org/spec/DD/20100524/DI"});var P=B();var ai=O(H,"bpmn:process",{id:P,name:I.name,isClosed:"false",processType:"None"});var ad=[];for(var ac=0;ac<ae.length;++ac){var W=ae[ac];if(W.type==="lane"){ad.push(W)}}(function Z(au,ar){if(!ar||!ar.length){return}var al=null;for(var aq=0;aq<ar.length;++aq){var an=ar[aq];if(an.type==="lane"){if(!al){al=O(au,"bpmn:laneSet",{id:B()})}var ao=O(al,"bpmn:lane",{id:an.id,name:an.label.text});var am=an.child;for(var ap=0;ap<am.length;++ap){var at=am[ap];O(ao,"bpmn:flowNodeRef",null,at.id)}Z(ao,an.child)}}})(ai,ad);var ak=function(am,an){var al={id:an.id,sourceRef:an.start,targetRef:an.end};if(an.label&&an.label.text){al.name=an.label.text}O(am,"bpmn:sequenceFlow",al)};var ag={};(function R(at,aq){if(!aq||!aq.length){return}for(var ap=0;ap<aq.length;++ap){var am=aq[ap],aw;var au=af(am);if(au){aw=O(at,au,{id:am.id,name:am.label.text});if(am.incoming){for(var ao=0;ao<am.incoming.length;++ao){O(aw,"bpmn:incoming",null,am.incoming[ao])}}if(am.outgoing){for(var ao=0;ao<am.outgoing.length;++ao){O(aw,"bpmn:outgoing",null,am.outgoing[ao])}}}R(aw?aw:at,am.child);if(au==="bpmn:subProcess"&&am.child&&am.child.length){var al={};for(var ao=0;ao<am.child.length;++ao){var ar=am.child[ao];al[ar.id]=true}var av=[];for(var ao=0;ao<L.links.length;++ao){var an=L.links[ao];if(al[an.start]&&al[an.end]){av.push(an)}}for(var ao=0;ao<av.length;++ao){var an=av[ao];ak(aw,an);ag[an.id]=true}}}})(ai,ae);for(var ac=0;ac<L.links.length;++ac){var Y=L.links[ac];if(!ag[Y.id]){ak(ai,Y)}}var S=O(O(H,"bpmndi:BPMNDiagram",{id:B(),documentation:"",resolution:"96"}),"bpmndi:BPMNPlane",{bpmnElement:P});var J=e.getModel();for(var ac=0;ac<L.nodes.length;++ac){var W=L.nodes[ac];var X={id:B(),bpmnElement:W.id};if(W.type==="lane"){X.isHorizontal="true"}var K=e.view.getState(J.getCell(W.id));var aj=K.cell.geometry;var ah=O(S,"bpmndi:BPMNShape",X);O(ah,"dc:Bounds",{x:aj.x,y:aj.y,width:aj.width,height:aj.height});if(K.text){var N=K.text.bounds;O(O(ah,"bpmndi:BPMNLabel"),"dc:Bounds",{x:N.x,y:N.y,width:N.width,height:N.height})}}for(var ac=0;ac<L.links.length;++ac){var W=L.links[ac];var X={id:B(),bpmnElement:W.id};var M=O(S,"bpmndi:BPMNEdge",X);var K=e.view.getState(J.getCell(W.id));var T=K.absolutePoints;for(var ab=0;ab<T.length;++ab){var U=T[ab];O(M,"di:waypoint",{x:U.x,y:U.y})}if(K.text){var N=K.text.bounds;O(O(M,"bpmndi:BPMNLabel"),"dc:Bounds",{x:N.x,y:N.y,width:N.width,height:N.height})}}return'<?xml version="1.0" encoding="UTF-8"?>'+V(aa)};function o(X){var Z=[];var L={};var aa=function(ac,ab){var ad={_parent:ac?ac.id:null,id:ab.id,geometry:{x:ab.x,y:ab.y,width:ab.width,height:ab.height},label:{text:ab.label},ref:ab,getParent:function(){return L[this._parent]}};if(ac){if(!ac.children){ac.children=[]}ac.children.push(ad)}else{Z.push(ad)}L[ad.id]=ad;return ad};var W=function(ab,ac){switch(ac.type){case"start":ab.type="start";ab.geometry.width=40;ab.geometry.height=40;return;case"end":ab.type="end";ab.geometry.width=40;ab.geometry.height=40;return;case"gateway":ab.type="gateway";ab.subtype="switch";ab.geometry.width=40;ab.geometry.height=40;return;case"gatewayOr":ab.type="gateway";ab.subtype="or";ab.geometry.width=40;ab.geometry.height=40;return;case"gatewayAnd":ab.type="gateway";ab.subtype="and";ab.geometry.width=40;ab.geometry.height=40;return;case"activity":ab.type="process";ab.geometry.width=100;ab.geometry.height=60;switch(ac.bpmn2TaskType){case"UserTask":switch(ac.loopType){case"simpleLoop":ab.subtype="HQ_seq";return;case"MultiInstanceLoop":ab.type="process";ab.subtype="HQ_par";return}return;case"SubProcess":ab.type="process";ab.subtype="sub";return;case"CalledProcess":ab.type="process";ab.subtype="link";return;case"ServiceTask":ab.type="process";ab.subtype="sys";return}default:console.error("!!!Unknow item.type="+S.type+" at "+V);console.error(S);break}};var O=[];var T=function(ae,ab,ac){var ad={id:ac.id,start:ae,startPosition:ac.startPosition,end:ab,endPosition:ac.endPosition,ref:ac};O.push(ad);return ad};var K=function(ab,ac){if(ac.needDefaultMarker){ab.type="default"}};var P=X.data.items;var I=[];for(var V=0;V<P.length;++V){var S=P[V];if(S.type==="swimlane"){I.push(S)}}var U={};while(true){var R=0;for(var V=0;V<I.length;++V){var S=I[V];if(S){var H=aa(U[S.lane],S);H.type="lane";U[S.label]=H;I[V]=null;R++}}if(R===0){break}}for(var V=0;V<P.length;++V){var S=P[V];if(S.type!=="swimlane"){var H=aa(U[S.lane],S);W(H,S)}}var J=X.data.links;for(var V=0;V<J.length;++V){var Y=J[V];var N=L[Y.start];var M=L[Y.end];if(N&&M){var Q=T(N,M,Y);K(Q,Y)}else{console.error("!!!Bad link at "+V);console.error(Y);console.error(N);console.error(M)}}return{width:X.data.width,height:X.data.height,links:O,rootnodes:Z}}function s(M){if(M.version==="1.0"){alert("不能从老的json导出格式导入");return false}var O=[];var L={};var I=M.nodes;for(var J=0;J<I.length;++J){var N=I[J];if(!N._parent){O.push(N)}L[N.id]=N;N.getParent=function(){return L[this._parent]}}for(var J=0;J<I.length;++J){var N=I[J];var K=N.getParent();if(K){if(!K.children){K.children=[]}K.children.push(N)}}var I=M.links;for(var J=0;J<I.length;++J){var H=I[J];H.start=L[H.start];H.end=L[H.end]}M.rootnodes=O;return true}function j(H){H=_.clone(H);delete H.geometry;return mxUtils.clone(H)}};