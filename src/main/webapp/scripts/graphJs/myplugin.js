mxGraph.prototype.getAncestors=function(){var a=[];var b=this;while(b.parent!=null){a.push(b.parent);b=b.parent}return a};mxRectangle.prototype.moveAndExpand=function(a){this.x+=a.x||0;this.y+=a.y||0;this.width+=a.width||0;this.height+=a.height||0;return this};mxRectangle.prototype.origin=function(){return new mxPoint(this.x,this.y)};mxRectangle.prototype.corner=function(){return new mxPoint(this.x+this.width,this.y+this.height)};mxRectangle.prototype.center=function(){return new mxPoint(this.x+this.width/2,this.y+this.height/2)};mxRectangle.prototype.containsPoint=function(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height};mxPoint.prototype.snapToGrid=function(b,a){this.x=snapToGrid(this.x,b);this.y=snapToGrid(this.y,a||b);return this};mxPoint.prototype.offset=function(a,b){this.x+=a||0;this.y+=b||0;return this};mxPoint.prototype.manhattanDistance=function(a){return Math.abs(a.x-this.x)+Math.abs(a.y-this.y)};mxPoint.prototype.difference=function(a){return new mxPoint(this.x-a.x,this.y-a.y)};mxPoint.prototype.theta=function(d){d=d.clone();var e=(d.y-this.y);var b=d.x-this.x;var c=10;var a=(e.toFixed(c)==0&&b.toFixed(c)==0)?0:Math.atan2(e,b);return 180*a/Math.PI};mxPoint.prototype.toString=function(){return this.x+"@"+this.y};var snapToGrid=function(b,a){return a*Math.round(b/a)};myRouters=(function(){var c={step:12,maximumLoops:1000,maxAllowedDirectionChange:90,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},paddingBox:function(){var o=this.step;return{x:-o,y:-o,width:2*o,height:2*o}},directions:function(){var o=this.step;return[{offsetX:o,offsetY:0,cost:1},{offsetX:0,offsetY:o,cost:1},{offsetX:-o,offsetY:0,cost:1},{offsetX:0,offsetY:-o,cost:1}]},penalties:function(){return{0:0,90:this.step/2,180:0}},draggingRoute:null};function k(o){this.map={};this.options=o;this.mapGridSize=100}k.prototype.build=function(s,r,t){var p=this.options;var q=_.union(_.map(s.getAncestors(r),"id"),_.map(s.getAncestors(t),"id"));var o=this.mapGridSize;_.chain(s.getModel().cells).filter(function(u){return u.isVertex()&&u.value&&u.style!=="swimlane"}).reject(function(u){return _.contains(q,u.id)}).map(function(u){return s.getCellBounds(u)}).each(function(u){if(!u){return}u.moveAndExpand(p.paddingBox)}).reduce(function(A,B){if(!A||!B){return}var v=B.origin().snapToGrid(o);var z=B.corner().snapToGrid(o);for(var u=v.x;u<=z.x;u+=o){for(var C=v.y;C<=z.y;C+=o){var w=u+"@"+C;A[w]=A[w]||[];A[w].push(B)}}return A},this.map).value();return this};k.prototype.isPointAccessible=function(o){var p=o.clone().snapToGrid(this.mapGridSize).toString();return _.every(this.map[p],function(q){return !q.containsPoint(o)})};function e(){this.items=[];this.hash={};this.OPEN=1;this.CLOSE=2}e.prototype.add=function(p,q){if(this.hash[p]){this.items.splice(this.items.indexOf(p),1)}else{this.hash[p]={status:this.OPEN}}this.hash[p].value=q;var o=_.sortedIndex(this.items,p,function(r){return this.hash[r].value},this);this.items.splice(o,0,p)};e.prototype.remove=function(o){this.hash[o].status=this.CLOSE};e.prototype.isOpen=function(o){return this.hash[o]&&(this.hash[o].status===this.OPEN)};e.prototype.isClose=function(o){return this.hash[o]&&(this.hash[o].status===this.CLOSE)};e.prototype.isEmpty=function(){return this.items.length===0};e.prototype.pop=function(){var o=this.items.shift();this.remove(o);return o};function f(v,t,o,q){function p(z){return new mxPoint(z.x===0?0:Math.abs(z.x)/z.x,z.y===0?0:Math.abs(z.y)/z.y)}var x=[];var s=p(q.difference(t));var r=t;var w;while((w=v[r])){var u=p(r.difference(w));if(!u.equals(s)){x.unshift(r);s=u}r=w}var y=p(r.difference(o));if(!y.equals(s)){x.unshift(r)}return x}function a(t,s,p){var q=p.step;var o=t.center();var r=_.chain(p.directionMap).pick(s).map(function(w){var v=w.x*t.width/2;var z=w.y*t.height/2;var u=o.clone().offset(v,z);if(t.containsPoint(u)){u.offset(w.x*q,w.y*q)}return u.snapToGrid(q)}).value();return r}function i(o){return(o%360)+(o<0?360:0)}function n(s,o,p){var r=360/p;return Math.floor(i(s.theta(o)+r/2)/r)*r}function m(q,p){var o=Math.abs(q-p);return o>180?360-o:o}function h(t,s){var q=Infinity;for(var p=0,o=s.length;p<o;p++){var r=t.manhattanDistance(s[p]);if(r<q){q=r}}return q}function b(p){var o=p.split(p.indexOf("@")===-1?" ":"@");return new mxPoint(parseInt(o[0],10),parseInt(o[1],10))}function d(q,v,w,r,z,y,x){var t=r.step;var o,u;var p,s;if(z){o=z.snapToGrid(t);u=y.snapToGrid(t);p=[z.clone().snapToGrid(t)];s=[y.clone().snapToGrid(t)]}else{p=_.filter(a(q,r.startDirections,r),w.isPointAccessible,w);s=_.filter(a(v,r.endDirections,r),w.isPointAccessible,w);o=q.center().snapToGrid(t);u=v.center().snapToGrid(t)}return j(p,s,o,u,w,r,x)}function j(s,B,J,H,F,o,r){if(!s.length||!B.length){return null}var p=new e();var E={};var t={};_.each(s,function(K){var L=K.toString();p.add(L,h(K,B));t[L]=0});var q=o.maximumLoops;var x=_.invoke(B,"toString");while(!p.isEmpty()&&q>0){var z=p.pop();var w=b(z);var u=t[z];var D=E[z]?n(E[z],w,o.directions.length):r;if(x.indexOf(z)>=0){return f(E,w,J,H)}for(var A=0;A<o.directions.length;A++){var y;var G=o.directions[A];y=m(D,G.angle);if(y>o.maxAllowedDirectionChange){continue}var I=w.clone().offset(G.offsetX,G.offsetY);var C=I.toString();if(x.indexOf(C)>=0){E[C]=w;t[C]=0;p.add(C,0);break}if(p.isClose(C)||!F.isPointAccessible(I)){continue}var v=u+G.cost+o.penalties[y];if(!p.isOpen(C)||v<t[C]){E[C]=w;t[C]=v;p.add(C,v+h(I,B))}}q--}return null}function g(o){o.directions=_.result(o,"directions");o.penalties=_.result(o,"penalties");o.paddingBox=_.result(o,"paddingBox");_.each(o.directions,function(r){var q=new mxPoint(0,0);var p=new mxPoint(r.offsetX,r.offsetY);r.angle=i(q.theta(p))})}function l(x,G,N,I,C,q){if((I!=null&&I.length>0)||G==null||N==null){mxEdgeStyle.SegmentConnector(x,G,N,I,C);return}var O=x.absolutePoints;if(!O||!O.length||!O[0]){return mxEdgeStyle.OrthConnector(x,G,N,I,C)}var r=O[0].clone();var M=O[O.length-1];if(!M){C.push(r);return mxEdgeStyle.OrthConnector(x,G,N,I,C)}M=M.clone();g(q);var s=x.view.graph;var E=s.getCellBounds(G.cell).clone().moveAndExpand(q.paddingBox);var J=s.getCellBounds(N.cell).clone().moveAndExpand(q.paddingBox);var K=(new k(q)).build(s,G.cell,N.cell);var z=q.step*2;var L=M.difference(r);if(Math.abs(L.x)<z*2&&Math.abs(L.y)<z*2){C.push(r);return mxEdgeStyle.OrthConnector(x,G,N,I,C)}var w;if(x.style.exitX===0){r.x-=z;w=180}else{if(x.style.exitX===1){r.x+=z;w=0}}if(x.style.exitY===0){r.y-=z;w=270}else{if(x.style.exitY===1){r.y+=z;w=90}}if(x.style.entryX===0){M.x-=z}else{if(x.style.entryX===1){M.x+=z}}if(x.style.entryY===0){M.y-=z}else{if(x.style.entryY===1){M.y+=z}}var p=d(E,J,K,q,r,M,w);if(p==null||!p.length){C.push(r);return mxEdgeStyle.OrthConnector(x,G,N,I,C)}r=O[0];M=O[O.length-1];var A,v,u,D,o,B,H;A=p[0];u=Math.abs(r.x-A.x);D=Math.abs(r.y-A.y);v=p[p.length-1];o=Math.abs(M.x-v.x);B=Math.abs(M.y-v.y);if(p.length===2&&((u<D&&o<B)||(u>=D&&o>=B))){if(u>D){A.x=r.x+(M.x-r.x)/2;A.y=r.y;v.x=r.x+(M.x-r.x)/2;v.y=M.y}else{A.y=r.y+(M.y-r.y)/2;A.x=r.x;v.y=r.y+(M.y-r.y)/2;v.x=M.x}}else{var H;if(u<D){var y;for(y=1;y<p.length;++y){var F=p[y];if(F.x!==A.x){break}}for(var H=0;H<y;H++){p[H].x=r.x}}else{var y;for(y=1;y<p.length;++y){var F=p[y];if(F.y!==A.y){break}}for(var H=0;H<y;H++){p[H].y=r.y}}if(o<B){var y;for(y=p.length-2;y>=0;--y){var F=p[y];if(F.x!==v.x){break}}for(y++;y<p.length;y++){p[y].x=M.x}}else{var y;for(y=p.length-2;y>=0;--y){var F=p[y];if(F.y!==v.y){break}}for(y++;y<p.length;y++){p[y].y=M.y}}}Array.prototype.push.apply(C,p)}return function(s,r,t,q,o,p){return l(s,r,t,q,o,_.extend({},c,p))}})();mxEdgeStyle.QinklConnector=function(d,c,e,b,a){var b=myRouters(d,c,e,b,a,{})};mxConstants.EDGESTYLE_QINKL="qinklEdgeStyle";mxStyleRegistry.putValue(mxConstants.EDGESTYLE_QINKL,mxEdgeStyle.QinklConnector);